{% extends 'StcBundle::base.html.twig' %}

{% block title %}
    Jouer
{% endblock %}

{% block content %}
    <main id="plateau" class="container-fluid visible-lg">

        <div class="row">

            <!-- Plateau -->
            <div id="tableau">
                {% include 'StcBundle:Game:plateau.html.twig' %}
            </div>
            <!-- /Plateau -->

            <!-- Menu latéral -->
            <div class="col-lg-1">
                <div class="row">
                    <a href="{{path('index')}}">

                        <img src="http://fakeimg.pl/87x87/?text=Accueil" alt="Accueil" title="Accueil" class="col-lg-12" id="jouer_accueil" />
                    </a>
                    <img src="http://fakeimg.pl/87x87/?text=Pouvoir_1" alt="Pouvoir 1" title="Pouvoir 1" class="col-lg-12 power" />
                    <img src="http://fakeimg.pl/87x87/?text=Pouvoir_2" alt="Pouvoir 2" title="Pouvoir 2" class="col-lg-12 power" />
                    <img src="http://fakeimg.pl/87x87/?text=Pouvoir_3" alt="Pouvoir 3" title="Pouvoir 3" class="col-lg-12 power" />
                </div>
            </div>
            <!-- /Menu latéral -->
        </div>

        <!-- Indications -->
        <div id="indications" class="row">
            <div class="col-lg-1 col-lg-offset-2">
                <span class="glyphicon glyphicon-arrow-left"></span> Q
            </div>
            <div class="col-lg-1">
                <span class="glyphicon glyphicon-arrow-right"></span> D
            </div>
            <div class="col-lg-1">
                <span class="glyphicon glyphicon-arrow-up"></span> Z
            </div>
            <div class="col-lg-1">
                <span class="glyphicon glyphicon-arrow-down"></span> S
            </div>
            <div class="col-lg-2 col-lg-offset-1">
                Espace <span class="glyphicon glyphicon-chevron-up"></span>
            </div>
        </div>
        <!-- /Indications -->

    </main>

    <!-- Résolution trop faible -->
    <main class="hidden-lg text-center">
        <h1>
            Vous n'avez pas la résolution nécessaire pour jouer à ce jeu.
        </h1>
        <p><a href="index.html">Retourner à l'accueil.</a></p>
    </main>
    <!-- /Résolution trop faible -->

    <script>

        var moveInProgress = false;

        $('body').keypress(function (e) {
            
            e.preventDefault();

            var gameWaiting = document.getElementById('#loading');
            
            if (moveInProgress || gameWaiting) {
                return;
            }

            switch (e.charCode) {
                case 113:
                    moveInProgress = true;
                    $.ajax({
                        url: '{{ path("controls", {"idGame" : idGame, "action" : "left"}) }}',
                        success: refreshTable
                    });
                    break;
                case 100:
                    moveInProgress = true;
                    $.ajax({
                        url: '{{ path("controls", {"idGame" : idGame, "action" : "right"}) }}',
                        success: refreshTable
                    });
                    break;
                case 122:
                    moveInProgress = true;
                    $.ajax({
                        url: '{{ path("controls", {"idGame" : idGame, "action" : "up"}) }}',
                        success: refreshTable
                    });
                    break;
                case 115:
                    moveInProgress = true;
                    $.ajax({
                        url: '{{ path("controls", {"idGame" : idGame, "action" : "down"}) }}',
                        success: refreshTable
                    });
                    break;
                case 32:
                    moveInProgress = true;
                    $.ajax({
                        url: '{{ path("controls", {"idGame" : idGame, "action" : "shoot"}) }}',
                        success: refreshTable
                    });
                    break;
            }
        });

        function refreshTable(view) {
            moveInProgress = false;
            $('#tableau').html(view);
        }


        setInterval(function(){
            $('#tableau').load('{{ path("controls", {"idGame" : idGame, "action" : "null"}) }}');
        }, 3000);
    
    </script>
{% endblock %}

